services:
  - type: web
    name: musician-backend
    runtime: node
    region: oregon
    plan: free
    rootDir: backend
    buildCommand: |
      npm install &&
      npx prisma generate &&
      npx prisma db push --accept-data-loss &&
      node -e "const{PrismaClient}=require('@prisma/client');const bcrypt=require('bcryptjs');const p=new PrismaClient();(async()=>{try{const h=await bcrypt.hash('2025',10);await p.admin.upsert({where:{email:'ruachkol@gmail.com'},update:{passcode:h},create:{email:'ruachkol@gmail.com',passcode:h}});console.log('✅ Admin setup complete!');}catch(e){console.error('❌ Admin setup failed:',e.message);}process.exit(0)})();"
    startCommand: npm start
    healthCheckPath: /api/content/settings
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 10000
