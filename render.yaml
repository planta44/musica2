services:
  - type: web
    name: musician-backend
    runtime: node
    region: singaporeSingapore (Southeast Asia)
    plan: free
    rootDir: backend
    buildCommand: |
      npm install &&
      npx prisma generate &&
      npx prisma db push --accept-data-loss &&
      node -e "const { PrismaClient } = require('@prisma/client'); const bcrypt = require('bcryptjs'); const p = new PrismaClient(); (async () => { const h = await bcrypt.hash(process.env.ADMIN_PASSCODE, 10); await p.admin.upsert({ where: { email: process.env.ADMIN_EMAIL }, update: { passcode: h }, create: { email: process.env.ADMIN_EMAIL, passcode: h } }); console.log('âœ… Admin setup complete!'); process.exit(0); })();"
    startCommand: npm start
    healthCheckPath: /api/content/settings
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 10000
      - key: ADMIN_EMAIL
        value: ruachkol@gmail.com
      - key: ADMIN_PASSCODE
        value: "2025"
      - key: JWT_SECRET
        value: c75a6b62d207912f813ac27944be56df50deb5156dba1c019dadee806bdb79dc24f452e87ff704a143652ff0e95351b50af94c93f4c0949ee7c2b281e600d1b2