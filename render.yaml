services:
  - type: web
    name: musician-backend
    runtime: node
    region: oregon
    plan: free
    rootDir: backend
    buildCommand: |
      cd backend &&
      npm install &&
      npx prisma generate &&
      npx prisma migrate deploy &&
      node -e "const{PrismaClient}=require('@prisma/client');const bcrypt=require('bcryptjs');const p=new PrismaClient();(async()=>{const h=await bcrypt.hash('2025',10);await p.admin.upsert({where:{email:'ruachkol@gmail.com'},update:{passcode:h},create:{email:'ruachkol@gmail.com',passcode:h}});console.log('âœ… Admin setup complete!');process.exit(0)})();"
    startCommand: npm start
    healthCheckPath: /api/content/settings
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 10000
