services:
  - type: web
    name: musician-backend
    runtime: node
    region: oregon
    plan: free
    rootDir: backend
    buildCommand: |
      npm install &&
      npx prisma generate &&
      npx prisma db push --accept-data-loss &&
      node -e "const{PrismaClient}=require('@prisma/client');const bcrypt=require('bcryptjs');const p=new PrismaClient();(async()=>{const h=await bcrypt.hash('2025',10);await p.admin.upsert({where:{email:process.env.ADMIN_EMAIL},update:{passcode:h},create:{email:process.env.ADMIN_EMAIL,passcode:h}});console.log('âœ… Admin setup complete!');process.exit(0)})();"
    startCommand: npm start
    healthCheckPath: /api/content/settings
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 10000
      - key: ADMIN_EMAIL
        value: ruachkol@gmail.com
      - key: JWT_SECRET
        value: your-super-secret-jwt-key-change-this-in-production
